h1. ThinkTank Tests

All code submitted to the repository should have corresponding tests that pass. Here's how to run and write tests.

h2. Running Tests

First, configure your test environment. Copy <code>tests/config.tests.sample.inc.php</code> to <code>tests/config.tests.inc.php</code> and set the appropriate values. You will need a clean, empty database to run your tests. By default, name it <code>thinktank_tests</code> and set the <code>$TEST_DATABASE</code> config variable to that name.

Then, to run a particular test, like the UserDAO test, in the thinktank source code root folder, use this command:

<code>$ php tests/TestOfUserDAO.php</code>

To run all the tests, use:

<code>$ php tests/all_tests.php</code>

The webapp tests contained in <code>tests/all_frontend_tests.php</code> assumes you have a local installation of ThinkTank and that it is using your test database. Make sure you update your <code>config.inc.php</code> to point to the <code>thinktank_tests</code> database before running the webapp tests. 

h2. Writing Tests

The test suite assumes there is an empty tests database (like <code>thinktank_tests</code>) which the default ThinkTank db user can access. If your test needs to read and write to the ThinkTank database, extend <code>ThinkTankUnitTestCase</code> and run <code>parent::setUp()</code> in your <code>setUp()</code> method, and <code>parent::tearDown()</code> in your <code>tearDown()</code> method. These methods create an empty copy of the ThinkTank database structure to execute a test, then drop all the tables in it when the test is complete. After you call the parent setUp() method in your test's setUp(), insert the data your test requires.

Best practices for writing tests are still getting developed. In the meantime, use some existing tests as examples.

h3. Model Tests (all_model_tests.php)

See <code>TestOfUserDAO.php</code> as an example of a set of DAO tests.

h3. Web Page Tests (all_frontend_tests.php)

Add tests for particular pages inside the webapp to an appropriately-named class. See <code>TestOfChangePassword.php</code> for an example.

h3. Plugin Tests (all_plugin_tests.php)

All plugin-specific tests should live in the <code>thinktank/webapp/plugins/plugin-name/tests/</code> directory. Write tests for the plugin's model objects and controller methods.

To test consumption of data from web services, mock up the appropriate classes and store test data to local files in the format the API would return them in.
For example, the <code>classes/mock.TwitterOAuth.php</code> class reads Twitter data from the files in the <code>testdata</code> directory.

See <code>/thinktank/webapp/plugins/twitter/tests/</code> for examples of Twitter crawler plugin tests.

Once your tests work, add them to the <code>all_tests.php</code> file to run along with the existing tests.